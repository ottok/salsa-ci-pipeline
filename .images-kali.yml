# Copyright salsa-ci-team and others
# SPDX-License-Identifier: FSFAP
# Copying and distribution of this file, with or without modification, are
# permitted in any medium without royalty provided the copyright notice and
# this notice are preserved. This file is offered as-is, without any warranty.
---
include:
  - .images-ci.yml

variables:
  ARCH: amd64
  VENDOR: kali
  BASE_IMAGE: "debian:testing"

# Images built on main branch
images-prod:
  stage: build
  extends: .build_template
  parallel:
    matrix:
      # All releases
      - IMAGE_NAME: base
        RELEASE:
          - kali-dev
          - kali-experimental
          - kali-rolling
      # All but experimental
      - IMAGE_NAME:
          - lintian
          - generic_tests
        RELEASE:
          - kali-dev
          - kali-rolling
      # Only kali-dev
      - IMAGE_NAME:
          - aptly
          - autopkgtest
          - blhc
          - gbp
          - piuparts
          - reprotest
        RELEASE: kali-dev
  only:
    variables:
      - $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      - $BUILD_ALL_IMAGES

# Images built on branches.
# This is a subset of all the images, and are the only ones
# built for branches != main.
image-staging:
  extends: .build_template
  stage: build
  parallel:
    matrix:
      - IMAGE_NAME:
          - aptly
          - autopkgtest
          - base
          - blhc
          - gbp
          - generic_tests
          - lintian
          - piuparts
          - reprotest
        RELEASE: kali-dev
  except:
    variables:
      - $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      - $BUILD_ALL_IMAGES
